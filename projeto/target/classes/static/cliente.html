<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cliente REST Simples</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

    <main class="main-content">
        <h1>Cliente REST (Atividade III)</h1>

        <h2>Cadastrar Nova Pessoa (via API REST)</h2>
        <form id="formCadastro">
            <div>
                <label for="nome">Nome:</label>
                <input type="text" id="nome" required>
            </div>
            <div>
                <label for="idade">Idade:</label>
                <input type="number" id="idade" required>
            </div>
            <button type="submit" class="botao">Salvar via API</button>
        </form>

        <h2>Pessoas Cadastradas (via API REST)</h2>
        <ul id="lista-pessoas" style="list-style: none; padding: 0;">
            </ul>
    </main>

    <script>
        // A URL da nossa API REST
        const apiUrl = '/api/pessoas';

        const listaPessoas = document.getElementById('lista-pessoas');
        const formCadastro = document.getElementById('formCadastro');
        const inputNome = document.getElementById('nome');
        const inputIdade = document.getElementById('idade');

        /**
         * Função para buscar pessoas na API e exibir na lista
         */
        async function listarPessoas() {
            // Limpa a lista antiga
            listaPessoas.innerHTML = 'Carregando...';

            try {
                // 1. Faz a requisição GET para a API
                const response = await fetch(apiUrl);
                const pessoas = await response.json();

                // Limpa o "Carregando..."
                listaPessoas.innerHTML = '';

                // 2. Cria os itens da lista para cada pessoa
                if (pessoas.length === 0) {
                    listaPessoas.innerHTML = '<li>Nenhuma pessoa cadastrada.</li>';
                    return;
                }

                pessoas.forEach(pessoa => {
                    const li = document.createElement('li');
                    li.textContent = `ID: ${pessoa.id} - Nome: ${pessoa.nome}, Idade: ${pessoa.idade}`;
                    li.style.border = "1px solid #ccc";
                    li.style.padding = "10px";
                    li.style.marginBottom = "5px";
                    listaPessoas.appendChild(li);
                });

            } catch (error) {
                console.error('Erro ao listar pessoas:', error);
                listaPessoas.innerHTML = '<li>Erro ao carregar a lista.</li>';
            }
        }

        /**
         * Função para cadastrar uma nova pessoa
         */
        async function cadastrarPessoa(event) {
            // Previne o recarregamento padrão da página
            event.preventDefault(); 

            const nome = inputNome.value;
            const idade = inputIdade.value;

            const novaPessoa = {
                nome: nome,
                idade: parseInt(idade) // Converte a idade para número
            };

            try {
                // 1. Faz a requisição POST para a API, enviando o JSON
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(novaPessoa)
                });

                if (response.ok) {
                    // 2. Limpa o formulário e atualiza a lista
                    inputNome.value = '';
                    inputIdade.value = '';
                    alert('Pessoa cadastrada com sucesso!');
                    listarPessoas(); // Atualiza a lista
                } else {
                    alert('Erro ao cadastrar pessoa.');
                }
            } catch (error) {
                console.error('Erro ao cadastrar pessoa:', error);
                alert('Erro de rede ao cadastrar.');
            }
        }

        // Adiciona o "escutador" de evento ao formulário
        formCadastro.addEventListener('submit', cadastrarPessoa);

        // Carrega a lista de pessoas assim que a página abre
        listarPessoas();

    </script>
</body>
</html>